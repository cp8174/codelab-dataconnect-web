# ============================================
# File Management Queries
# ============================================

# List all files (optionally filtered by folder)
query ListFiles($folderId: UUID) @auth(level: USER) {
  files(
    where: {
      _and: [
        { uploadedBy: { eq_expr: "auth.uid" } }
        { folderId: { eq: $folderId } }
      ]
    }
    orderBy: { uploadedAt: DESC }
  ) {
    id
    name
    storagePath
    mimeType
    size
    folderId
    uploadedBy
    uploadedAt
    updatedAt
    description
    tags
    isPublic
    downloadCount
  }
}

# List all files by user
query ListFilesByUser @auth(level: USER) {
  files(where: { uploadedBy: { eq_expr: "auth.uid" } }, orderBy: { uploadedAt: DESC }) {
    id
    name
    storagePath
    mimeType
    size
    folderId
    uploadedBy
    uploadedAt
    description
    tags
    downloadCount
  }
}

# Get a single file by ID
query GetFile($id: UUID!) @auth(level: USER) {
  files(
    where: {
      _and: [
        { id: { eq: $id } }
        { uploadedBy: { eq_expr: "auth.uid" } }
      ]
    }
    limit: 1
  ) {
    id
    name
    storagePath
    mimeType
    size
    folderId
    folder {
      id
      name
    }
    uploadedBy
    uploadedAt
    updatedAt
    description
    tags
    isPublic
    downloadCount
  }
}

# List all folders (optionally filtered by parent folder)
query ListFolders($parentFolderId: UUID) @auth(level: USER) {
  folders(
    where: {
      _and: [
        { createdBy: { eq_expr: "auth.uid" } }
        { parentFolderId: { eq: $parentFolderId } }
      ]
    }
    orderBy: { createdAt: DESC }
  ) {
    id
    name
    parentFolderId
    createdBy
    createdAt
    description
    color
  }
}

# Get a single folder by ID
query GetFolder($id: UUID!) @auth(level: USER) {
  folders(
    where: {
      _and: [
        { id: { eq: $id } }
        { createdBy: { eq_expr: "auth.uid" } }
      ]
    }
    limit: 1
  ) {
    id
    name
    parentFolderId
    parentFolder {
      id
      name
    }
    createdBy
    createdAt
    description
    color
  }
}

# Search files by name
query SearchFiles($searchTerm: String!) @auth(level: USER) {
  files(
    where: {
      _and: [
        { uploadedBy: { eq_expr: "auth.uid" } }
        { name: { contains: $searchTerm } }
      ]
    }
    orderBy: { uploadedAt: DESC }
  ) {
    id
    name
    storagePath
    mimeType
    size
    folderId
    uploadedBy
    uploadedAt
    description
    tags
    downloadCount
  }
}

# Get recent files
query GetRecentFiles($limit: Int = 20) @auth(level: USER) {
  files(
    where: { uploadedBy: { eq_expr: "auth.uid" } }
    orderBy: { uploadedAt: DESC }
    limit: $limit
  ) {
    id
    name
    storagePath
    mimeType
    size
    folderId
    uploadedBy
    uploadedAt
    description
    tags
    downloadCount
  }
}

# Get storage stats for a user
query GetUserStorageStats @auth(level: USER) {
  files(where: { uploadedBy: { eq_expr: "auth.uid" } }) {
    size
  }
}

# ============================================
# Archive Queries
# ============================================

# List archived files for current user
query ListArchivedFiles @auth(level: USER) {
  files(
    where: {
      _and: [
        { uploadedBy: { eq_expr: "auth.uid" } }
        { isArchived: { eq: true } }
      ]
    }
    orderBy: { archivedAt: DESC }
  ) {
    id
    name
    storagePath
    mimeType
    size
    uploadedBy
    uploadedAt
    archivedAt
    description
    tags
    downloadCount
  }
}

# Get count of archived files
query GetArchivedFilesCount @auth(level: USER) {
  files(
    where: {
      _and: [
        { uploadedBy: { eq_expr: "auth.uid" } }
        { isArchived: { eq: true } }
      ]
    }
  ) {
    id
  }
}
