 # Copyright 2024 Google LLC
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #      http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #

# Upsert (update or insert) a user based on their username
# Create or update the current authenticated user
mutation UpsertUser($username: String!) @auth(level: USER) {
  user_upsert(
    data: {
      id_expr: "auth.uid"
      username: $username
    }
  )
}


# Add a movie to the user's favorites list
mutation AddFavoritedMovie($movieId: UUID!) @auth(level: USER) {
  favorite_movie_upsert(data: { userId_expr: "auth.uid", movieId: $movieId })
}

# Remove a movie from the user's favorites list
mutation DeleteFavoritedMovie($movieId: UUID!) @auth(level: USER) {
  favorite_movie_delete(key: { userId_expr: "auth.uid", movieId: $movieId })
}

# Add a review for a movie
mutation AddReview($movieId: UUID!, $rating: Int!, $reviewText: String!)
@auth(level: USER) {
  review_insert(
    data: {
      userId_expr: "auth.uid"
      movieId: $movieId
      rating: $rating
      reviewText: $reviewText
      reviewDate_date: { today: true }
    }
  )
}

# Delete a user's review for a movie
mutation DeleteReview($movieId: UUID!) @auth(level: USER) {
  review_delete(key: { userId_expr: "auth.uid", movieId: $movieId })
}



# The mutations below are unused by the application, but are useful examples for more complex cases

# Create a movie based on user input
# mutation CreateMovie(
#   $title: String!
#   $releaseYear: Int!
#   $genre: String!
#   $rating: Float
#   $description: String
#   $imageUrl: String!
#   $tags: [String!] = []
# ) @auth(expr: "auth.token.isAdmin == true") {

# }
# Update movie information based on the provided ID
# mutation UpdateMovie(
#   $id: UUID!
#   $title: String
#   $releaseYear: Int
#   $genre: String
#   $rating: Float
#   $description: String
#   $imageUrl: String
#   $tags: [String!] = []
# ) @auth(level: USER_EMAIL_VERIFIED) {
#   movie_update(
#     id: $id
#     data: {
#       title: $title
#       releaseYear: $releaseYear
#       genre: $genre
#       rating: $rating
#       description: $description
#       imageUrl: $imageUrl
#       tags: $tags
#     }
#   )
# }

# Delete a movie by its ID
# mutation DeleteMovie($id: UUID!) @auth(level: USER_EMAIL_VERIFIED) {
#   movie_delete(id: $id)
# }

# Delete movies with a rating lower than the specified minimum rating
# mutation DeleteUnpopularMovies($minRating: Float!) @auth(level: USER_EMAIL_VERIFIED) {
#   movie_deleteMany(where: { rating: { le: $minRating } })
# }
# End of example mutations

# ============================================
# File Management Mutations
# ============================================

# Create a new file entry (after uploading to storage)
mutation CreateFile(
  $name: String!
  $storagePath: String!
  $mimeType: String
  $size: Int64!
  $folderId: UUID
  $uploadedBy: String!
  $description: String
  $tags: [String!]
  $isPublic: Boolean
) @auth(level: PUBLIC) {
  file_insert(
    data: {
      name: $name
      storagePath: $storagePath
      mimeType: $mimeType
      size: $size
      folderId: $folderId
      uploadedBy: $uploadedBy
      description: $description
      tags: $tags
      isPublic: $isPublic
    }
  )
}

# Update file metadata
mutation UpdateFile(
  $id: UUID!
  $name: String
  $description: String
  $tags: [String!]
  $isPublic: Boolean
  $folderId: UUID
) @auth(level: PUBLIC) {
  file_update(
    id: $id
    data: {
      name: $name
      description: $description
      tags: $tags
      isPublic: $isPublic
      folderId: $folderId
    }
  )
}

# Delete a file entry
mutation DeleteFile($id: UUID!) @auth(level: PUBLIC) {
  file_delete(id: $id)
}

# Increment download count
mutation IncrementDownloadCount($id: UUID!, $newCount: Int!) @auth(level: PUBLIC) {
  file_update(
    id: $id
    data: { downloadCount: $newCount }
  )
}

# Create a new folder
mutation CreateFolder(
  $name: String!
  $parentFolderId: UUID
  $createdBy: String!
  $description: String
  $color: String
) @auth(level: PUBLIC) {
  folder_insert(
    data: {
      name: $name
      parentFolderId: $parentFolderId
      createdBy: $createdBy
      description: $description
      color: $color
    }
  )
}

# Update folder
mutation UpdateFolder(
  $id: UUID!
  $name: String
  $description: String
  $color: String
) @auth(level: PUBLIC) {
  folder_update(
    id: $id
    data: {
      name: $name
      description: $description
      color: $color
    }
  )
}

# Delete a folder
mutation DeleteFolder($id: UUID!) @auth(level: PUBLIC) {
  folder_delete(id: $id)
}